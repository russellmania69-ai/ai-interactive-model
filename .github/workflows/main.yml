import { createClient } from '@supabase/supabase-js';

// Initialize Supabase client with environment variables.
// In production builds we require `VITE_SUPABASE_URL` and `VITE_SUPABASE_KEY`
// to be present; otherwise fail fast so we don't silently use a wrong project.
const envSupabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const envSupabaseKey = import.meta.env.VITE_SUPABASE_KEY;

let supabaseUrl = envSupabaseUrl;
let supabaseKey = envSupabaseKey;

// During local development, keep the existing fallbacks for convenience.
// In production (built with Vite's `--mode production`), throw if missing.
if (import.meta.env.PROD) {
  if (!supabaseUrl || !supabaseKey) {
    // Log an explicit error and throw to prevent creating a client with wrong credentials.
    console.error('Missing VITE_SUPABASE_URL or VITE_SUPABASE_KEY in production build.');
    throw new Error(
      'Missing VITE_SUPABASE_URL or VITE_SUPABASE_KEY in production build. ' +
        'Add them to `.env.production` and rebuild before deploying.'
    );
  }
} else {
  // Development: do not embed real project secrets in the repo. If env vars are
  // missing, print a warning and allow local dev to proceed with no Supabase
  // client configured. Developers should add `.env.local` with their own
  // `VITE_SUPABASE_URL` and `VITE_SUPABASE_KEY` values.
  if (!supabaseUrl || !supabaseKey) {
    console.warn('VITE_SUPABASE_URL or VITE_SUPABASE_KEY not set. Supabase client will be disabled in dev.');
  }
}

const supabase = createClient(supabaseUrl, supabaseKey);

export { supabase };
